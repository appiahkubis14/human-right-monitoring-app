
{% extends 'base/web_base.html' %}

{% block content %}
<br>
<div class="page-content">
    <div class="page-container">
         <div class="content container-fluid">
        <!-- Page Header -->
         <br>
         
        <div class="page-header" style="display: flex;justify-content: space-between;">
            <div class="col">
                <h3 class="page-title">All Farmers</h3>
                <div class="text-end">
                    <ol class="breadcrumb m-0 py-0">
                        <li class="breadcrumb-item"><a href="javascript: void(0);">HRM</a></li>
                        <li class="breadcrumb-item active">Child Labor Monitoring</li>
                    </ol>
                </div>
            </div>
            <div class="col-auto">
                <button class="btn btn-primary me-2" data-bs-toggle="modal" data-bs-target="#addFarmerModal">
                    <i class="ti ti-plus me-1"></i> Add Farmer
                </button>
                <button class="btn btn-outline-success" id="exportBtn">
                    <i class="ti ti-download me-1"></i> Export
                </button>
            </div>
        </div>
        <!-- /Page Header -->

        <!-- Farmer Table -->
        <div class="row">
            <div class="col-sm-12">
                <div class="card">
                    <div class="card-body">
                        <div class="table-responsive">
                            <table id="farmersTable" class="table table-striped table-hover">
                                <thead>
                                    <tr>
                                        <th>ID</th>
                                        <th>Name</th>
                                        <th>Community</th>
                                        <th>Farm Size</th>
                                        <th>Crop Type</th>
                                        <th>Risk Level</th>
                                        <th>Status</th>
                                        <th class="text-end">Actions</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td>F001</td>
                                        <td>John Doe</td>
                                        <td>North Community</td>
                                        <td>5.2 acres</td>
                                        <td>Cocoa</td>
                                        <td><span class="badge bg-success">Low</span></td>
                                        <td><span class="badge bg-success">Active</span></td>
                                        <td class="text-end">
                                            <div class="dropdown dropdown-action">
                                                <a href="#" class="action-icon dropdown-toggle" data-bs-toggle="dropdown" aria-expanded="false"><i class="ti ti-dots-vertical"></i></a>
                                                <div class="dropdown-menu dropdown-menu-right">
                                                    <a class="dropdown-item" href="#"><i class="ti ti-eye me-2"></i>View</a>
                                                    <a class="dropdown-item" href="#"><i class="ti ti-pencil me-2"></i>Edit</a>
                                                    <a class="dropdown-item" href="#"><i class="ti ti-trash me-2"></i>Delete</a>
                                                </div>
                                            </div>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>F002</td>
                                        <td>Jane Smith</td>
                                        <td>South Community</td>
                                        <td>3.8 acres</td>
                                        <td>Coffee</td>
                                        <td><span class="badge bg-warning">Medium</span></td>
                                        <td><span class="badge bg-success">Active</span></td>
                                        <td class="text-end">
                                            <div class="dropdown dropdown-action">
                                                <a href="#" class="action-icon dropdown-toggle" data-bs-toggle="dropdown" aria-expanded="false"><i class="ti ti-dots-vertical"></i></a>
                                                <div class="dropdown-menu dropdown-menu-right">
                                                    <a class="dropdown-item" href="#"><i class="ti ti-eye me-2"></i>View</a>
                                                    <a class="dropdown-item" href="#"><i class="ti ti-pencil me-2"></i>Edit</a>
                                                    <a class="dropdown-item" href="#"><i class="ti ti-trash me-2"></i>Delete</a>
                                                </div>
                                            </div>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>F003</td>
                                        <td>Robert Johnson</td>
                                        <td>East Community</td>
                                        <td>7.5 acres</td>
                                        <td>Palm Oil</td>
                                        <td><span class="badge bg-danger">High</span></td>
                                        <td><span class="badge bg-success">Inactive</span></td>
                                        <td class="text-end">
                                            <div class="dropdown dropdown-action">
                                                <a href="#" class="action-icon dropdown-toggle" data-bs-toggle="dropdown" aria-expanded="false"><i class="ti ti-dots-vertical"></i></a>
                                                <div class="dropdown-menu dropdown-menu-right">
                                                    <a class="dropdown-item" href="#"><i class="ti ti-eye me-2"></i>View</a>
                                                    <a class="dropdown-item" href="#"><i class="ti ti-pencil me-2"></i>Edit</a>
                                                    <a class="dropdown-item" href="#"><i class="ti ti-trash me-2"></i>Delete</a>
                                                </div>
                                            </div>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>F004</td>
                                        <td>Sarah Williams</td>
                                        <td>West Community</td>
                                        <td>4.1 acres</td>
                                        <td>Cocoa</td>
                                        <td><span class="badge bg-success">Low</span></td>
                                        <td><span class="badge bg-success">Active</span></td>
                                        <td class="text-end">
                                            <div class="dropdown dropdown-action">
                                                <a href="#" class="action-icon dropdown-toggle" data-bs-toggle="dropdown" aria-expanded="false"><i class="ti ti-dots-vertical"></i></a>
                                                <div class="dropdown-menu dropdown-menu-right">
                                                    <a class="dropdown-item" href="#"><i class="ti ti-eye me-2"></i>View</a>
                                                    <a class="dropdown-item" href="#"><i class="ti ti-pencil me-2"></i>Edit</a>
                                                    <a class="dropdown-item" href="#"><i class="ti ti-trash me-2"></i>Delete</a>
                                                </div>
                                            </div>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>F005</td>
                                        <td>Michael Brown</td>
                                        <td>Central Community</td>
                                        <td>6.3 acres</td>
                                        <td>Rubber</td>
                                        <td><span class="badge bg-warning">Medium</span></td>
                                        <td><span class="badge bg-success">Active</span></td>
                                        <td class="text-end">
                                            <div class="dropdown dropdown-action">
                                                <a href="#" class="action-icon dropdown-toggle" data-bs-toggle="dropdown" aria-expanded="false"><i class="ti ti-dots-vertical"></i></a>
                                                <div class="dropdown-menu dropdown-menu-right">
                                                    <a class="dropdown-item" href="#"><i class="ti ti-eye me-2"></i>View</a>
                                                    <a class="dropdown-item" href="#"><i class="ti ti-pencil me-2"></i>Edit</a>
                                                    <a class="dropdown-item" href="#"><i class="ti ti-trash me-2"></i>Delete</a>
                                                </div>
                                            </div>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- /Farmer Table -->
    </div>

    <!-- Add Farmer Modal -->
    <div class="modal fade" id="addFarmerModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Add New Farmer</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form>
                        <div class="row">
                            <div class="col-12">
                                <div class="form-group">
                                    <label>Full Name</label>
                                    <input type="text" class="form-control">
                                </div>
                            </div>
                            <div class="col-sm-6">
                                <div class="form-group">
                                    <label>Community</label>
                                    <select class="form-select">
                                        <option>Select Community</option>
                                        <option>North Community</option>
                                        <option>South Community</option>
                                        <option>East Community</option>
                                        <option>West Community</option>
                                        <option>Central Community</option>
                                    </select>
                                </div>
                            </div>
                            <div class="col-sm-6">
                                <div class="form-group">
                                    <label>Farm Size (acres)</label>
                                    <input type="number" class="form-control" step="0.1">
                                </div>
                            </div>
                            <div class="col-sm-6">
                                <div class="form-group">
                                    <label>Primary Crop</label>
                                    <select class="form-select">
                                        <option>Select Crop</option>
                                        <option>Cocoa</option>
                                        <option>Coffee</option>
                                        <option>Palm Oil</option>
                                        <option>Rubber</option>
                                        <option>Other</option>
                                    </select>
                                </div>
                            </div>
                            <div class="col-sm-6">
                                <div class="form-group">
                                    <label>Risk Level</label>
                                    <select class="form-select">
                                        <option>Select Risk Level</option>
                                        <option>Low</option>
                                        <option>Medium</option>
                                        <option>High</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-success" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary">Add Farmer</button>
                </div>
            </div>
        </div>
    </div>
    <!-- /Add Farmer Modal -->



<!-- First load jQuery, then DataTables and its extensions -->
<script src="https://code.jquery.com/jquery-3.7.0.min.js"></script>

<script>
$(document).ready(function() {
    // Initialize DataTable with comprehensive features
    var table = $('#farmersTable').DataTable({
        dom: '<"row"<"col-md-3"l><"col-md-5"B><"col-md-4"f>>' +
             '<"row"<"col-md-12"tr>>' +
             '<"row"<"col-md-6"i><"col-md-6"p>>',
        buttons: [
            {
                extend: 'collection',
                text: '<i class="ti ti-settings me-1"></i> Settings',
                className: 'btn btn-sm btn-outline-success dropdown-toggle',
                buttons: [
                    {
                        extend: 'colvis',
                        text: 'Column Visibility',
                        className: 'dropdown-item'
                    },
                    {
                        extend: 'pageLength',
                        text: 'Page Length',
                        className: 'dropdown-item'
                    }
                ]
            },
            {
                extend: 'collection',
                text: '<i class="ti ti-download me-1"></i> Export',
                className: 'btn btn-sm btn-outline-success dropdown-toggle',
                buttons: [
                    {
                        extend: 'copy',
                        text: 'Copy to clipboard',
                        className: 'dropdown-item',
                        exportOptions: {
                            columns: ':visible'
                        }
                    },
                    {
                        extend: 'csv',
                        text: 'Export as CSV',
                        className: 'dropdown-item',
                        exportOptions: {
                            columns: ':visible'
                        }
                    },
                    {
                        extend: 'excel',
                        text: 'Export as Excel',
                        className: 'dropdown-item',
                        exportOptions: {
                            columns: ':visible'
                        }
                    },
                    {
                        extend: 'pdf',
                        text: 'Export as PDF',
                        className: 'dropdown-item',
                        exportOptions: {
                            columns: ':visible'
                        }
                    },
                    {
                        extend: 'print',
                        text: 'Print',
                        className: 'dropdown-item',
                        exportOptions: {
                            columns: ':visible'
                        },
                        customize: function (win) {
                            $(win.document.body).find('h1').text('Farmers Report');
                        }
                    }
                ]
            },
            {
                text: '<i class="ti ti-refresh me-1"></i> Refresh',
                className: 'btn btn-sm btn-outline-success',
                action: function (e, dt, node, config) {
                    dt.ajax.reload();
                }
            }
        ],
        language: {
            search: "_INPUT_",
            searchPlaceholder: "Search farmers...",
            lengthMenu: "Show _MENU_ entries",
            paginate: {
                previous: "<i class='ti ti-chevron-left'>",
                next: "<i class='ti ti-chevron-right'>"
            },
            info: "Showing _START_ to _END_ of _TOTAL_ farmers",
            infoEmpty: "Showing 0 to 0 of 0 farmers",
            infoFiltered: "(filtered from _MAX_ total farmers)"
        },
        pageLength: 10,
        lengthMenu: [[5, 10, 25, 50, -1], [5, 10, 25, 50, "All"]],
        responsive: true,
        ordering: true,
        order: [[1, 'asc']],
        columnDefs: [
            { 
                orderable: false, 
                targets: -1, // Actions column
                searchable: false
            }
        ]
    });

    // Style DataTable buttons
    $('.dt-buttons .btn').removeClass('btn-success');
    
    // Export button click handler
    $('#exportBtn').on('click', function() {
        $('.dt-button-collection').show();
    });
    
    // Custom search for risk level badges
    $.fn.dataTable.ext.search.push(
        function(settings, data, dataIndex) {
            var riskLevel = $('#riskLevelFilter').val();
            if (!riskLevel || riskLevel === 'all') {
                return true;
            }
            
            var rowRisk = data[5].toLowerCase(); // Risk level is in column index 5
            return rowRisk.indexOf(riskLevel.toLowerCase()) !== -1;
        }
    );
    
    // Add risk level filter
    // $('<div class="mb-3"><label>Filter by Risk Level: </label>' +
    //   '<select id="riskLevelFilter" class="form-select form-select-sm d-inline-block w-auto ms-2">' +
    //   '<option value="all">All</option>' +
    //   '<option value="low">Low</option>' +
    //   '<option value="medium">Medium</option>' +
    //   '<option value="high">High</option>' +
    //   '</select></div>').insertBefore('#farmersTable_wrapper');
    
    // // Apply filter on change
    // $('#riskLevelFilter').on('change', function() {
    //     table.draw();
    // });
    
    // // Status filter
    // $('<div class="mb-3 ms-2"><label>Filter by Status: </label>' +
    //   '<select id="statusFilter" class="form-select form-select-sm d-inline-block w-auto ms-2">' +
    //   '<option value="all">All</option>' +
    //   '<option value="active">Active</option>' +
    //   '<option value="inactive">Inactive</option>' +
    //   '</select></div>').insertBefore('#farmersTable_wrapper');
    
    $.fn.dataTable.ext.search.push(
        function(settings, data, dataIndex) {
            var status = $('#statusFilter').val();
            if (!status || status === 'all') {
                return true;
            }
            
            var rowStatus = data[6].toLowerCase(); // Status is in column index 6
            return rowStatus.indexOf(status.toLowerCase()) !== -1;
        }
    );
    
    $('#statusFilter').on('change', function() {
        table.draw();
    });
    
    // Add clear filters button
    $('<button class="btn btn-sm btn-outline-success ms-2" id="clearFilters">Clear Filters</button>')
        .insertAfter('#statusFilter')
        .on('click', function() {
            $('#riskLevelFilter, #statusFilter').val('all');
            table.search('').columns().search('').draw();
        });
    
    // Row selection highlighting
    $('#farmersTable tbody').on('click', 'tr', function() {
        $(this).toggleClass('selected');
    });
});
</script>

<style>
    /* Custom styling for DataTables */
    .dataTables_wrapper .dataTables_filter {
        float: right;
        text-align: right;
    }
    
    .dataTables_wrapper .dataTables_length {
        float: left;
    }
    
    .dataTables_wrapper .dataTables_info {
        float: left;
    }
    
    .dataTables_wrapper .dataTables_paginate {
        float: right;
    }
    
    .table-responsive {
        overflow-x: auto;
    }
    
    #farmersTable tr.selected {
        background-color: rgba(13, 253, 121, 0.1) !important;
    }
    
    .dt-button-collection {
        display: none;
        position: absolute;
        background: white;
        border: 1px solid #ddd;
        border-radius: 4px;
        padding: 5px;
        z-index: 1000;
    }
</style>
    </div>
</div>

{% endblock content %}