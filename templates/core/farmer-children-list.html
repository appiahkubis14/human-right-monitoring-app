{% extends 'base/web_base.html' %}
{% load static %}

{% block content %}

<div class="page-content">
    <div class="page-container">

    <div class="content container-fluid">
        <br>
        <!-- Page Header -->
        <div class="page-header" style="display: flex;justify-content: space-between;">
            <div class="col">
                <h3 class="page-title">Farmer Children</h3>
                <ul class="breadcrumb">
                    <li class="breadcrumb-item"><a href="/">Dashboard</a></li>
                    <li class="breadcrumb-item active">Farmer Management</li>
                    <li class="breadcrumb-item active">Farmer Children</li>
                </ul>
            </div>
            <div class="col-auto">
                <button class="btn btn-primary me-2" data-bs-toggle="modal" data-bs-target="#addChildModal">
                    <i class="ti ti-plus me-1"></i> Add Child
                </button>
                <button class="btn btn-outline-secondary" id="exportBtn">
                    <i class="ti ti-download me-1"></i> Export
                </button>
            </div>
        </div>
        <!-- /Page Header -->

        <!-- Farmer Children Table -->
        <div class="row">
            <div class="col-sm-12">
                <div class="card">
                    <div class="card-body">
                        <div class="table-responsive">
                            <table id="childrenTable" class="table table-striped table-hover">
                                <thead>
                                    <tr>
                                        <th>Child ID</th>
                                        <th>Name</th>
                                        <th>Age</th>
                                        <th>Gender</th>
                                        <th>Parent Name</th>
                                        <th>Parent ID</th>
                                        <th>School Status</th>
                                        <th>Education Level</th>
                                        <th>Health Status</th>
                                        <th class="text-end">Actions</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td>C001</td>
                                        <td>Emma Doe</td>
                                        <td>12</td>
                                        <td>Female</td>
                                        <td>John Doe</td>
                                        <td>F001</td>
                                        <td><span class="badge bg-success">Enrolled</span></td>
                                        <td>Primary 6</td>
                                        <td><span class="badge bg-success">Good</span></td>
                                        <td class="text-end">
                                            <div class="dropdown dropdown-action">
                                                <a href="#" class="action-icon dropdown-toggle" data-bs-toggle="dropdown" aria-expanded="false"><i class="ti ti-dots-vertical"></i></a>
                                                <div class="dropdown-menu dropdown-menu-right">
                                                    <a class="dropdown-item" href="#"><i class="ti ti-eye me-2"></i>View</a>
                                                    <a class="dropdown-item" href="#"><i class="ti ti-pencil me-2"></i>Edit</a>
                                                    <a class="dropdown-item" href="#"><i class="ti ti-trash me-2"></i>Delete</a>
                                                </div>
                                            </div>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>C002</td>
                                        <td>James Smith</td>
                                        <td>9</td>
                                        <td>Male</td>
                                        <td>Jane Smith</td>
                                        <td>F002</td>
                                        <td><span class="badge bg-success">Enrolled</span></td>
                                        <td>Primary 4</td>
                                        <td><span class="badge bg-success">Good</span></td>
                                        <td class="text-end">
                                            <div class="dropdown dropdown-action">
                                                <a href="#" class="action-icon dropdown-toggle" data-bs-toggle="dropdown" aria-expanded="false"><i class="ti ti-dots-vertical"></i></a>
                                                <div class="dropdown-menu dropdown-menu-right">
                                                    <a class="dropdown-item" href="#"><i class="ti ti-eye me-2"></i>View</a>
                                                    <a class="dropdown-item" href="#"><i class="ti ti-pencil me-2"></i>Edit</a>
                                                    <a class="dropdown-item" href="#"><i class="ti ti-trash me-2"></i>Delete</a>
                                                </div>
                                            </div>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>C003</td>
                                        <td>Sarah Johnson</td>
                                        <td>15</td>
                                        <td>Female</td>
                                        <td>Robert Johnson</td>
                                        <td>F003</td>
                                        <td><span class="badge bg-warning">Not Enrolled</span></td>
                                        <td>JHS 2</td>
                                        <td><span class="badge bg-info">Fair</span></td>
                                        <td class="text-end">
                                            <div class="dropdown dropdown-action">
                                                <a href="#" class="action-icon dropdown-toggle" data-bs-toggle="dropdown" aria-expanded="false"><i class="ti ti-dots-vertical"></i></a>
                                                <div class="dropdown-menu dropdown-menu-right">
                                                    <a class="dropdown-item" href="#"><i class="ti ti-eye me-2"></i>View</a>
                                                    <a class="dropdown-item" href="#"><i class="ti ti-pencil me-2"></i>Edit</a>
                                                    <a class="dropdown-item" href="#"><i class="ti ti-trash me-2"></i>Delete</a>
                                                </div>
                                            </div>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>C004</td>
                                        <td>Michael Williams</td>
                                        <td>7</td>
                                        <td>Male</td>
                                        <td>Sarah Williams</td>
                                        <td>F004</td>
                                        <td><span class="badge bg-success">Enrolled</span></td>
                                        <td>Primary 2</td>
                                        <td><span class="badge bg-success">Good</span></td>
                                        <td class="text-end">
                                            <div class="dropdown dropdown-action">
                                                <a href="#" class="action-icon dropdown-toggle" data-bs-toggle="dropdown" aria-expanded="false"><i class="ti ti-dots-vertical"></i></a>
                                                <div class="dropdown-menu dropdown-menu-right">
                                                    <a class="dropdown-item" href="#"><i class="ti ti-eye me-2"></i>View</a>
                                                    <a class="dropdown-item" href="#"><i class="ti ti-pencil me-2"></i>Edit</a>
                                                    <a class="dropdown-item" href="#"><i class="ti ti-trash me-2"></i>Delete</a>
                                                </div>
                                            </div>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>C005</td>
                                        <td>Grace Brown</td>
                                        <td>11</td>
                                        <td>Female</td>
                                        <td>Michael Brown</td>
                                        <td>F005</td>
                                        <td><span class="badge bg-success">Enrolled</span></td>
                                        <td>Primary 5</td>
                                        <td><span class="badge bg-warning">Needs Checkup</span></td>
                                        <td class="text-end">
                                            <div class="dropdown dropdown-action">
                                                <a href="#" class="action-icon dropdown-toggle" data-bs-toggle="dropdown" aria-expanded="false"><i class="ti ti-dots-vertical"></i></a>
                                                <div class="dropdown-menu dropdown-menu-right">
                                                    <a class="dropdown-item" href="#"><i class="ti ti-eye me-2"></i>View</a>
                                                    <a class="dropdown-item" href="#"><i class="ti ti-pencil me-2"></i>Edit</a>
                                                    <a class="dropdown-item" href="#"><i class="ti ti-trash me-2"></i>Delete</a>
                                                </div>
                                            </div>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>C006</td>
                                        <td>David Doe</td>
                                        <td>14</td>
                                        <td>Male</td>
                                        <td>John Doe</td>
                                        <td>F001</td>
                                        <td><span class="badge bg-success">Enrolled</span></td>
                                        <td>JHS 1</td>
                                        <td><span class="badge bg-success">Good</span></td>
                                        <td class="text-end">
                                            <div class="dropdown dropdown-action">
                                                <a href="#" class="action-icon dropdown-toggle" data-bs-toggle="dropdown" aria-expanded="false"><i class="ti ti-dots-vertical"></i></a>
                                                <div class="dropdown-menu dropdown-menu-right">
                                                    <a class="dropdown-item" href="#"><i class="ti ti-eye me-2"></i>View</a>
                                                    <a class="dropdown-item" href="#"><i class="ti ti-pencil me-2"></i>Edit</a>
                                                    <a class="dropdown-item" href="#"><i class="ti ti-trash me-2"></i>Delete</a>
                                                </div>
                                            </div>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>C007</td>
                                        <td>Linda Smith</td>
                                        <td>6</td>
                                        <td>Female</td>
                                        <td>Jane Smith</td>
                                        <td>F002</td>
                                        <td><span class="badge bg-success">Enrolled</span></td>
                                        <td>Kindergarten</td>
                                        <td><span class="badge bg-success">Good</span></td>
                                        <td class="text-end">
                                            <div class="dropdown dropdown-action">
                                                <a href="#" class="action-icon dropdown-toggle" data-bs-toggle="dropdown" aria-expanded="false"><i class="ti ti-dots-vertical"></i></a>
                                                <div class="dropdown-menu dropdown-menu-right">
                                                    <a class="dropdown-item" href="#"><i class="ti ti-eye me-2"></i>View</a>
                                                    <a class="dropdown-item" href="#"><i class="ti ti-pencil me-2"></i>Edit</a>
                                                    <a class="dropdown-item" href="#"><i class="ti ti-trash me-2"></i>Delete</a>
                                                </div>
                                            </div>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- /Farmer Children Table -->
    </div>

    <!-- Add Child Modal -->
    <div class="modal fade" id="addChildModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Add New Child</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form>
                        <div class="row">
                            <div class="col-12">
                                <div class="form-group">
                                    <label>Child's Full Name</label>
                                    <input type="text" class="form-control" placeholder="Enter child's name">
                                </div>
                            </div>
                            <div class="col-sm-6">
                                <div class="form-group">
                                    <label>Age</label>
                                    <input type="number" class="form-control" placeholder="Enter age">
                                </div>
                            </div>
                            <div class="col-sm-6">
                                <div class="form-group">
                                    <label>Gender</label>
                                    <select class="form-select">
                                        <option value="">Select Gender</option>
                                        <option value="male">Male</option>
                                        <option value="female">Female</option>
                                    </select>
                                </div>
                            </div>
                            <div class="col-sm-6">
                                <div class="form-group">
                                    <label>Parent Farmer</label>
                                    <select class="form-select">
                                        <option value="">Select Parent</option>
                                        <option value="F001">John Doe (F001)</option>
                                        <option value="F002">Jane Smith (F002)</option>
                                        <option value="F003">Robert Johnson (F003)</option>
                                        <option value="F004">Sarah Williams (F004)</option>
                                        <option value="F005">Michael Brown (F005)</option>
                                    </select>
                                </div>
                            </div>
                            <div class="col-sm-6">
                                <div class="form-group">
                                    <label>School Status</label>
                                    <select class="form-select">
                                        <option value="">Select Status</option>
                                        <option value="enrolled">Enrolled</option>
                                        <option value="not_enrolled">Not Enrolled</option>
                                        <option value="dropped_out">Dropped Out</option>
                                    </select>
                                </div>
                            </div>
                            <div class="col-sm-6">
                                <div class="form-group">
                                    <label>Education Level</label>
                                    <select class="form-select">
                                        <option value="">Select Level</option>
                                        <option value="kindergarten">Kindergarten</option>
                                        <option value="primary">Primary School</option>
                                        <option value="jhs">Junior High School</option>
                                        <option value="shs">Senior High School</option>
                                        <option value="tertiary">Tertiary</option>
                                    </select>
                                </div>
                            </div>
                            <div class="col-sm-6">
                                <div class="form-group">
                                    <label>Health Status</label>
                                    <select class="form-select">
                                        <option value="">Select Status</option>
                                        <option value="good">Good</option>
                                        <option value="fair">Fair</option>
                                        <option value="poor">Poor</option>
                                        <option value="needs_checkup">Needs Checkup</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary">Add Child</button>
                </div>
            </div>
        </div>
    </div>
    <!-- /Add Child Modal -->
    </div>

</div>
<!-- DataTables CSS -->
<link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/dataTables.bootstrap5.min.css">
<link rel="stylesheet" href="https://cdn.datatables.net/buttons/2.4.1/css/buttons.bootstrap5.min.css">
<link rel="stylesheet" href="https://cdn.datatables.net/responsive/2.5.0/css/responsive.bootstrap5.min.css">

<script src="https://code.jquery.com/jquery-3.7.0.min.js"></script>
<script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
<script src="https://cdn.datatables.net/1.13.6/js/dataTables.bootstrap5.min.js"></script>
<script src="https://cdn.datatables.net/buttons/2.4.1/js/dataTables.buttons.min.js"></script>
<script src="https://cdn.datatables.net/buttons/2.4.1/js/buttons.bootstrap5.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.53/pdfmake.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.53/vfs_fonts.js"></script>
<script src="https://cdn.datatables.net/buttons/2.4.1/js/buttons.html5.min.js"></script>
<script src="https://cdn.datatables.net/buttons/2.4.1/js/buttons.print.min.js"></script>
<script src="https://cdn.datatables.net/buttons/2.4.1/js/buttons.colVis.min.js"></script>
<script src="https://cdn.datatables.net/responsive/2.5.0/js/dataTables.responsive.min.js"></script>
<script src="https://cdn.datatables.net/responsive/2.5.0/js/responsive.bootstrap5.min.js"></script>

<script>
$(document).ready(function() {
    // Initialize DataTable with comprehensive features
    var table = $('#childrenTable').DataTable({
        processing: true,
        dom: '<"row"<"col-md-3"l><"col-md-5"B><"col-md-4"f>>' +
             '<"row"<"col-md-12"tr>>' +
             '<"row"<"col-md-6"i><"col-md-6"p>>',
        buttons: [
            {
                extend: 'collection',
                text: '<i class="ti ti-settings me-1"></i> Settings',
                className: 'btn btn-sm btn-outline-secondary dropdown-toggle',
                buttons: [
                    {
                        extend: 'colvis',
                        text: 'Column Visibility',
                        className: 'dropdown-item'
                    },
                    {
                        extend: 'pageLength',
                        text: 'Page Length',
                        className: 'dropdown-item'
                    }
                ]
            },
            {
                extend: 'collection',
                text: '<i class="ti ti-download me-1"></i> Export',
                className: 'btn btn-sm btn-outline-secondary dropdown-toggle',
                buttons: [
                    {
                        extend: 'copy',
                        text: 'Copy to clipboard',
                        className: 'dropdown-item',
                        exportOptions: {
                            columns: ':visible'
                        }
                    },
                    {
                        extend: 'csv',
                        text: 'Export as CSV',
                        className: 'dropdown-item',
                        exportOptions: {
                            columns: ':visible'
                        }
                    },
                    {
                        extend: 'excel',
                        text: 'Export as Excel',
                        className: 'dropdown-item',
                        exportOptions: {
                            columns: ':visible'
                        }
                    },
                    {
                        extend: 'pdf',
                        text: 'Export as PDF',
                        className: 'dropdown-item',
                        exportOptions: {
                            columns: ':visible'
                        }
                    },
                    {
                        extend: 'print',
                        text: 'Print',
                        className: 'dropdown-item',
                        exportOptions: {
                            columns: ':visible'
                        },
                        customize: function (win) {
                            $(win.document.body).find('h1').text('Farmer Children Report');
                        }
                    }
                ]
            },
            {
                text: '<i class="ti ti-refresh me-1"></i> Refresh',
                className: 'btn btn-sm btn-outline-secondary',
                action: function (e, dt, node, config) {
                    dt.ajax.reload();
                }
            }
        ],
        language: {
            search: "_INPUT_",
            searchPlaceholder: "Search children...",
            lengthMenu: "Show _MENU_ entries",
            paginate: {
                previous: "<i class='ti ti-chevron-left'>",
                next: "<i class='ti ti-chevron-right'>"
            },
            info: "Showing _START_ to _END_ of _TOTAL_ children",
            infoEmpty: "Showing 0 to 0 of 0 children",
            infoFiltered: "(filtered from _MAX_ total children)"
        },
        pageLength: 10,
        lengthMenu: [[5, 10, 25, 50, -1], [5, 10, 25, 50, "All"]],
        responsive: true,
        ordering: true,
        order: [[1, 'asc']],
        columnDefs: [
            { 
                orderable: false, 
                targets: -1, // Actions column
                searchable: false
            },
            {
                targets: [2], // Age column
                type: 'num'
            }
        ]
    });

    // Style DataTable buttons
    $('.dt-buttons .btn').removeClass('btn-secondary');
    
    // Export button click handler
    $('#exportBtn').on('click', function() {
        $('.dt-button-collection').show();
    });
    
    // Add filter container above the table
    $('<div class="filter-container"><h6>Filter Children</h6><div class="row"></div></div>').insertBefore('#childrenTable_wrapper');
    
    // School Status filter
    $('<div class="col-md-3 mb-2"><label>School Status: </label>' +
      '<select id="schoolStatusFilter" class="form-select form-select-sm">' +
      '<option value="">All</option>' +
      '<option value="enrolled">Enrolled</option>' +
      '<option value="not enrolled">Not Enrolled</option>' +
      '</select></div>').appendTo('.filter-container .row');
    
    $.fn.dataTable.ext.search.push(
        function(settings, data, dataIndex) {
            var schoolStatus = $('#schoolStatusFilter').val();
            if (!schoolStatus) {
                return true;
            }
            
            var rowStatus = data[6].toLowerCase(); // School status is in column index 6
            return rowStatus.indexOf(schoolStatus.toLowerCase()) !== -1;
        }
    );
    
    $('#schoolStatusFilter').on('change', function() {
        table.draw();
    });
    
    // Health Status filter
    $('<div class="col-md-3 mb-2"><label>Health Status: </label>' +
      '<select id="healthStatusFilter" class="form-select form-select-sm">' +
      '<option value="">All</option>' +
      '<option value="good">Good</option>' +
      '<option value="fair">Fair</option>' +
      '<option value="poor">Poor</option>' +
      '<option value="needs checkup">Needs Checkup</option>' +
      '</select></div>').appendTo('.filter-container .row');
    
    $.fn.dataTable.ext.search.push(
        function(settings, data, dataIndex) {
            var healthStatus = $('#healthStatusFilter').val();
            if (!healthStatus) {
                return true;
            }
            
            var rowHealth = data[8].toLowerCase(); // Health status is in column index 8
            return rowHealth.indexOf(healthStatus.toLowerCase()) !== -1;
        }
    );
    
    $('#healthStatusFilter').on('change', function() {
        table.draw();
    });
    
    // Age Range filter
    $('<div class="col-md-3 mb-2"><label>Age Range: </label>' +
      '<select id="ageRangeFilter" class="form-select form-select-sm">' +
      '<option value="">All Ages</option>' +
      '<option value="0-5">0-5 years</option>' +
      '<option value="6-12">6-12 years</option>' +
      '<option value="13-18">13-18 years</option>' +
      '</select></div>').appendTo('.filter-container .row');
    
    $.fn.dataTable.ext.search.push(
        function(settings, data, dataIndex) {
            var ageRange = $('#ageRangeFilter').val();
            if (!ageRange) {
                return true;
            }
            
            var age = parseInt(data[2]); // Age is in column index 2
            
            if (ageRange === '0-5') return age >= 0 && age <= 5;
            if (ageRange === '6-12') return age >= 6 && age <= 12;
            if (ageRange === '13-18') return age >= 13 && age <= 18;
            
            return true;
        }
    );
    
    $('#ageRangeFilter').on('change', function() {
        table.draw();
    });
    
    // Add clear filters button
    $('<div class="col-md-3 mb-2"><label>&nbsp;</label><br>' +
      '<button class="btn btn-sm btn-outline-secondary w-100" id="clearFilters">Clear Filters</button></div>')
      .appendTo('.filter-container .row')
      .on('click', function() {
          $('#schoolStatusFilter, #healthStatusFilter, #ageRangeFilter').val('');
          table.search('').columns().search('').draw();
      });
    
    // Row selection highlighting
    $('#childrenTable tbody').on('click', 'tr', function() {
        $(this).toggleClass('selected');
    });
    
    
});
</script>
{% endblock %}