<!-- farmer_children/farmer_children.html -->
{% extends 'base/web_base.html' %}
{% load static %}

{% block content %}
<div class="page-content">
    <div class="page-container">
        <br>
        <div class="row">
            <div class="col-12">
                <div class="card">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <div class="mb-3">
                            <div>
                                <h4 style="font-weight: bolder;">FARMER CHILDREN MANAGEMENT</h4>
                                <p class="mb-0">Manage and monitor children living in farmer households</p>
                            </div>
                        </div>
                        <button class="btn btn-gradient-primary btn-sm" id="newChildBtn">
                            <i class="fas fa-plus"></i> NEW CHILD RECORD
                        </button>
                    </div>
                    <div class="card-body">
                        <!-- Filters -->
                        <div class="row mb-3">
                            <div class="col-md-3">
                                <label class="form-label">Education Status</label>
                                <select class="form-select" id="educationFilter">
                                    <option value="">All Statuses</option>
                                    <option value="enrolled">Enrolled</option>
                                    <option value="not_enrolled">Not Enrolled</option>
                                </select>
                            </div>
                            <div class="col-md-3">
                                <label class="form-label">Work Status</label>
                                <select class="form-select" id="workFilter">
                                    <option value="">All Statuses</option>
                                    <option value="working">Working</option>
                                    <option value="not_working">Not Working</option>
                                </select>
                            </div>
                            <div class="col-md-3">
                                <label class="form-label">Gender</label>
                                <select class="form-select" id="genderFilter">
                                    <option value="">All Genders</option>
                                    <option value="Male">Male</option>
                                    <option value="Female">Female</option>
                                </select>
                            </div>
                            <div class="col-md-3">
                                <label class="form-label">District</label>
                                <select class="form-select" id="districtFilter">
                                    <option value="">All Districts</option>
                                    <!-- Districts will be loaded via AJAX -->
                                </select>
                            </div>
                        </div>
                        <div class="row mb-3">
                            <div class="col-md-4">
                                <label class="form-label">Community</label>
                                <select class="form-select" id="communityFilter">
                                    <option value="">All Communities</option>
                                    <!-- Communities will be loaded via AJAX -->
                                </select>
                            </div>
                            <div class="col-md-4">
                                <label class="form-label">Farmer</label>
                                <select class="form-select" id="farmerFilter">
                                    <option value="">All Farmers</option>
                                    <!-- Farmers will be loaded via AJAX -->
                                </select>
                            </div>
                            <div class="col-md-4">
                                <label class="form-label">Age Range</label>
                                <select class="form-select" id="ageFilter">
                                    <option value="">All Ages</option>
                                    <option value="5-10">5-10 years</option>
                                    <option value="11-14">11-14 years</option>
                                    <option value="15-17">15-17 years</option>
                                </select>
                            </div>
                        </div>

                        <!-- Statistics Cards -->
                        <div class="row mb-4">
                            <div class="col-md-3">
                                <div class="card bg-primary text-white">
                                    <div class="card-body">
                                        <div class="d-flex justify-content-between">
                                            <div>
                                                <h6 class="card-title">TOTAL CHILDREN</h6>
                                                <h3 id="totalChildren">0</h3>
                                            </div>
                                            <div class="align-self-center">
                                                <i class="fas fa-child fa-2x"></i>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="card bg-success text-white">
                                    <div class="card-body">
                                        <div class="d-flex justify-content-between">
                                            <div>
                                                <h6 class="card-title">ENROLLED IN SCHOOL</h6>
                                                <h3 id="enrolledCount">0</h3>
                                            </div>
                                            <div class="align-self-center">
                                                <i class="fas fa-graduation-cap fa-2x"></i>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="card bg-warning text-white">
                                    <div class="card-body">
                                        <div class="d-flex justify-content-between">
                                            <div>
                                                <h6 class="card-title">WORKING CHILDREN</h6>
                                                <h3 id="workingCount">0</h3>
                                            </div>
                                            <div class="align-self-center">
                                                <i class="fas fa-briefcase fa-2x"></i>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="card bg-info text-white">
                                    <div class="card-body">
                                        <div class="d-flex justify-content-between">
                                            <div>
                                                <h6 class="card-title">BIRTH CERTIFICATES</h6>
                                                <h3 id="birthCertCount">0</h3>
                                            </div>
                                            <div class="align-self-center">
                                                <i class="fas fa-id-card fa-2x"></i>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Children Table -->
                        <div class="table-responsive">
                            <table id="childrenTable" class="table table-striped table-bordered" style="width:100%">
                                <thead>
                                    <tr>
                                        <th>CHILD ID</th>
                                        <th>FULL NAME</th>
                                        <th>AGE</th>
                                        <th>GENDER</th>
                                        <th>FARMER</th>
                                        <th>COMMUNITY</th>
                                        <th>DISTRICT</th>
                                        <th>EDUCATION</th>
                                        <th>WORK STATUS</th>
                                        <th>BIRTH CERT.</th>
                                        <th>REGISTERED</th>
                                        <th>ACTIONS</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <!-- Data will be loaded via AJAX -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Child Details Modal -->
        <div class="modal fade" id="childModal" tabindex="-1" aria-hidden="true">
            <div class="modal-dialog modal-xl">
                <div class="modal-content">
                    <div class="modal-header text-white bg-primary">
                        <h5 class="modal-title" id="modalTitle">Child Details</h5>
                        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <div id="childDetails">
                            <!-- Child details will be loaded here -->
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- New Child Modal -->
        <div class="modal fade" id="newChildModal" tabindex="-1" aria-hidden="true">
            <div class="modal-dialog modal-lg">
                <div class="modal-content">
                    <div class="modal-header text-white bg-primary">
                        <h5 class="modal-title">New Child Record</h5>
                        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <form id="childForm" class="needs-validation" novalidate>
                        {% csrf_token %}
                        <div class="modal-body">
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label class="form-label">Farmer*</label>
                                        <select class="form-select" id="farmer" name="farmer" required>
                                            <option value="" selected disabled>Select Farmer</option>
                                            <!-- Farmers will be loaded via AJAX -->
                                        </select>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label class="form-label">Household*</label>
                                        <select class="form-select" id="household" name="household_id" required>
                                            <option value="" selected disabled>Select Household</option>
                                            <!-- Households will be loaded based on farmer selection -->
                                        </select>
                                    </div>
                                </div>
                            </div>
                            <div class="row mt-3">
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label class="form-label">First Name*</label>
                                        <input type="text" class="form-control" id="firstName" name="child_first_name" required>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label class="form-label">Last Name*</label>
                                        <input type="text" class="form-control" id="lastName" name="child_surname" required>
                                    </div>
                                </div>
                            </div>
                            <div class="row mt-3">
                                <div class="col-md-4">
                                    <div class="form-group">
                                        <label class="form-label">Gender*</label>
                                        <select class="form-select" id="gender" name="child_gender" required>
                                            <option value="" selected disabled>Select Gender</option>
                                            <option value="Male">Male</option>
                                            <option value="Female">Female</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-group">
                                        <label class="form-label">Year of Birth*</label>
                                        <input type="number" class="form-control" id="yearOfBirth" name="child_year_birth" 
                                               min="2007" max="2020" required>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-group">
                                        <label class="form-label">Birth Certificate</label>
                                        <select class="form-select" id="birthCertificate" name="child_birth_certificate">
                                            <option value="no">No</option>
                                            <option value="yes">Yes</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                            <div class="row mt-3">
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label class="form-label">School Enrollment</label>
                                        <select class="form-select" id="educationStatus" name="child_educated">
                                            <option value="0">Not Enrolled</option>
                                            <option value="1">Enrolled</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label class="form-label">School Name</label>
                                        <input type="text" class="form-control" id="schoolName" name="child_school_name">
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                            <button type="submit" class="btn btn-primary">Save Child</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- JavaScript -->
  <script src="https://code.jquery.com/jquery-3.7.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script>
$(document).ready(function() {
    // Initialize DataTable
    const childrenTable = $('#childrenTable').DataTable({
        paging: true,
        searching: true,
        ordering: true,
        info: true,
        responsive: true,
        autoWidth: false,
        processing: true,
        serverSide: false,
        lengthMenu: [10, 25, 50, 100],
        pageLength: 10,
        ajax: {
            url: "{% url 'farmer_children_list_api' %}",
            type: "GET",
            data: function(d) {
                return {
                    farmer: $('#farmerFilter').val(),
                    community: $('#communityFilter').val(),
                    district: $('#districtFilter').val(),
                    gender: $('#genderFilter').val(),
                    education_status: $('#educationFilter').val(),
                    work_status: $('#workFilter').val()
                };
            },
            dataSrc: function(json) {
                updateStatistics(json.statistics);
                return json.data;
            }
        },
        columns: [
            { data: 'child_id' },
            { data: 'full_name' },
            { data: 'age' },
            { data: 'gender' },
            { data: 'farmer_name' },
            { data: 'community' },
            { data: 'district' },
            { 
                data: 'education_status',
                render: function(data) {
                    let badgeClass = data === 'Enrolled' ? 'bg-success' : 'bg-warning';
                    return `<span class="badge ${badgeClass}">${data}</span>`;
                }
            },
            { 
                data: 'work_status',
                render: function(data) {
                    let badgeClass = data === 'Working' ? 'bg-danger' : 'bg-info';
                    return `<span class="badge ${badgeClass}">${data}</span>`;
                }
            },
            { 
                data: 'has_birth_certificate',
                render: function(data) {
                    return data === 'yes' ? 
                        '<i class="fas fa-check text-success"></i>' : 
                        '<i class="fas fa-times text-danger"></i>';
                }
            },
            { data: 'created_at' },
            {
                data: 'id',
                render: function(data, type, row) {
                    return `
                        <div class="btn-group">
                            <button class="btn btn-primary btn-sm view-child-btn" data-id="${data}" title="View Details">
                                <i class="fas fa-eye"></i>
                            </button>
                            <button class="btn btn-info btn-sm edit-child-btn" data-id="${data}" title="Edit">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="btn btn-danger btn-sm delete-child-btn" data-id="${data}" title="Delete">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    `;
                },
                orderable: false
            }
        ],
        dom: 'Bfrtip',
        buttons: [
            {
                extend: "copy",
                text: '<i class="fas fa-copy"></i> Copy',
                className: "btn btn-sm btn-outline-secondary",
            },
            {
                extend: "csv",
                text: '<i class="fas fa-file-csv"></i> CSV',
                className: "btn btn-sm btn-outline-success",
            },
            {
                extend: "excel",
                text: '<i class="fas fa-file-excel"></i> Excel',
                className: "btn btn-sm btn-outline-primary",
            },
            {
                extend: "pdf",
                text: '<i class="fas fa-file-pdf"></i> PDF',
                className: "btn btn-sm btn-outline-danger",
            },
            {
                text: '<i class="fas fa-chart-bar"></i> Report',
                className: "btn btn-sm btn-outline-info",
                action: function() {
                    generateChildrenReport();
                }
            }
        ],
        language: {
            emptyTable: "No children records found.",
            zeroRecords: "No matching records found."
        }
    });

    // Load filter options
    function loadFilterOptions() {
        // Load districts
        $.ajax({
            url: "{% url 'get_districts_api' %}",
            type: "GET",
            success: function(data) {
                $('#districtFilter').empty().append('<option value="" selected>All Districts</option>');
                $.each(data, function(index, item) {
                    $('#districtFilter').append($('<option>', {
                        value: item.id,
                        text: item.district
                    }));
                });
            }
        });

        // Load communities
        $.ajax({
            url: "{% url 'get_communities_api' %}",
            type: "GET",
            success: function(data) {
                $('#communityFilter').empty().append('<option value="" selected>All Communities</option>');
                $.each(data, function(index, item) {
                    $('#communityFilter').append($('<option>', {
                        value: item.id,
                        text: item.society
                    }));
                });
            }
        });

        // Load farmers
        // $.ajax({
        //     url: "{% url 'get_farmers_api' %}",
        //     type: "GET",
        //     success: function(data) {
        //         $('#farmerFilter, #farmer').empty().append('<option value="" selected disabled>Select Farmer</option>');
        //         $.each(data, function(index, item) {
        //             $('#farmerFilter, #farmer').append($('<option>', {
        //                 value: item.id,
        //                 text: `${item.first_name} ${item.last_name} (${item.farmer_code})`
        //             }));
        //         });
        //     }
        // });
    }

    // Update statistics
    function updateStatistics(stats) {
        $('#totalChildren').text(stats.total_children);
        $('#enrolledCount').text(stats.enrolled_count);
        $('#workingCount').text(stats.working_count);
        $('#birthCertCount').text(stats.enrolled_count); // This would need actual birth cert count
    }

    // Filter change events
    $('#educationFilter, #workFilter, #genderFilter, #districtFilter, #communityFilter, #farmerFilter, #ageFilter').change(function() {
        childrenTable.ajax.reload();
    });

    // ----- VIEW CHILD DETAILS -----
    $(document).on('click', '.view-child-btn', function() {
        const childId = $(this).data('id');
        viewChildDetails(childId);
    });

    function viewChildDetails(childId) {
        $.ajax({
            url: "{% url 'farmer_child_detail_api' 0 %}".replace('0', childId),
            type: "GET",
            beforeSend: function() {
                showLoadingAlert('Loading child details...');
            },
            success: function(response) {
                Swal.close();
                if (response.success) {
                    displayChildDetails(response.data);
                    $('#childModal').modal('show');
                } else {
                    showErrorAlert(response.message || 'Failed to load child details');
                }
            },
            error: function(xhr) {
                handleAjaxError(xhr, 'load child details');
            }
        });
    }

    function displayChildDetails(data) {
        const detailsHtml = `
            <div class="row mb-4">
                <div class="col-md-8">
                    <h4>${data.full_name}</h4>
                    <p class="text-muted">${data.age} years old • ${data.gender} • Born in ${data.year_of_birth}</p>
                </div>
                <div class="col-md-4 text-end">
                    <span class="badge ${data.education.is_enrolled ? 'bg-success' : 'bg-warning'} fs-6">
                        ${data.education.is_enrolled ? 'Enrolled in School' : 'Not Enrolled'}
                    </span>
                </div>
            </div>

            <div class="row">
                <div class="col-md-6">
                    <div class="card mb-4">
                        <div class="card-header bg-light">
                            <h6 class="mb-0">Personal Information</h6>
                        </div>
                        <div class="card-body">
                            <div class="row mb-2">
                                <div class="col-6"><strong>Full Name:</strong></div>
                                <div class="col-6">${data.full_name}</div>
                            </div>
                            <div class="row mb-2">
                                <div class="col-6"><strong>Age:</strong></div>
                                <div class="col-6">${data.age} years</div>
                            </div>
                            <div class="row mb-2">
                                <div class="col-6"><strong>Gender:</strong></div>
                                <div class="col-6">${data.gender}</div>
                            </div>
                            <div class="row mb-2">
                                <div class="col-6"><strong>Birth Certificate:</strong></div>
                                <div class="col-6">${data.birth_certificate === 'yes' ? 'Yes' : 'No'}</div>
                            </div>
                            ${data.birth_certificate_reason ? `
                            <div class="row mb-2">
                                <div class="col-6"><strong>Reason:</strong></div>
                                <div class="col-6">${data.birth_certificate_reason}</div>
                            </div>
                            ` : ''}
                        </div>
                    </div>

                    <div class="card mb-4">
                        <div class="card-header bg-light">
                            <h6 class="mb-0">Family Information</h6>
                        </div>
                        <div class="card-body">
                            <div class="row mb-2">
                                <div class="col-6"><strong>Farmer:</strong></div>
                                <div class="col-6">${data.farmer.name}</div>
                            </div>
                            <div class="row mb-2">
                                <div class="col-6"><strong>Farmer Code:</strong></div>
                                <div class="col-6">${data.farmer.code}</div>
                            </div>
                            <div class="row mb-2">
                                <div class="col-6"><strong>Community:</strong></div>
                                <div class="col-6">${data.community}</div>
                            </div>
                            <div class="row mb-2">
                                <div class="col-6"><strong>District:</strong></div>
                                <div class="col-6">${data.district}</div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="col-md-6">
                    <div class="card mb-4">
                        <div class="card-header bg-light">
                            <h6 class="mb-0">Education Information</h6>
                        </div>
                        <div class="card-body">
                            ${data.education.is_enrolled ? `
                                <div class="row mb-2">
                                    <div class="col-6"><strong>School Name:</strong></div>
                                    <div class="col-6">${data.education.school_name || 'N/A'}</div>
                                </div>
                                <div class="row mb-2">
                                    <div class="col-6"><strong>Grade:</strong></div>
                                    <div class="col-6">${data.education.grade || 'N/A'}</div>
                                </div>
                                <div class="row mb-2">
                                    <div class="col-6"><strong>School Type:</strong></div>
                                    <div class="col-6">${data.education.school_type || 'N/A'}</div>
                                </div>
                            ` : `
                                <div class="alert alert-warning">
                                    Child is not currently enrolled in school.
                                </div>
                            `}
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-header bg-light">
                            <h6 class="mb-0">Work Information</h6>
                        </div>
                        <div class="card-body">
                            <div class="row mb-2">
                                <div class="col-6"><strong>House Work:</strong></div>
                                <div class="col-6">${data.work.house_work ? 'Yes' : 'No'}</div>
                            </div>
                            <div class="row mb-2">
                                <div class="col-6"><strong>Cocoa Work:</strong></div>
                                <div class="col-6">${data.work.cocoa_work ? 'Yes' : 'No'}</div>
                            </div>
                            ${data.work.house_work || data.work.cocoa_work ? `
                                <div class="row mb-2">
                                    <div class="col-6"><strong>Work Frequency:</strong></div>
                                    <div class="col-6">${data.work.work_frequency || 'N/A'}</div>
                                </div>
                                <div class="row mb-2">
                                    <div class="col-6"><strong>Tasks Performed:</strong></div>
                                    <div class="col-6">${data.work.tasks_performed.join(', ') || 'None'}</div>
                                </div>
                            ` : ''}
                        </div>
                    </div>
                </div>
            </div>

            <div class="row mt-4">
                <div class="col-12">
                    <div class="card">
                        <div class="card-header bg-light">
                            <h6 class="mb-0">Registration Information</h6>
                        </div>
                        <div class="card-body">
                            <div class="row">
                                <div class="col-md-6">
                                    <strong>Registered:</strong> ${data.created_at}
                                </div>
                                <div class="col-md-6">
                                    <strong>Last Updated:</strong> ${data.updated_at}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        `;
        
        $('#childDetails').html(detailsHtml);
    }

    // ----- CREATE NEW CHILD RECORD -----
    $('#newChildBtn').click(function() {
        $('#childForm')[0].reset();
        loadFilterOptions();
        $('#newChildModal').modal('show');
    });

    // Load households when farmer is selected
    $('#farmer').change(function() {
        const farmerId = $(this).val();
        if (farmerId) {
            // This would need an API endpoint to get households by farmer
            // For now, we'll use a placeholder
            $('#household').empty().append('<option value="" selected disabled>Loading households...</option>');
            
            // Simulate API call - replace with actual API endpoint
            setTimeout(() => {
                $('#household').empty().append('<option value="1" selected>Main Household</option>');
            }, 500);
        }
    });

    $('#childForm').submit(function(e) {
        e.preventDefault();
        
        if (!this.checkValidity()) {
            e.stopPropagation();
            this.classList.add('was-validated');
            return;
        }
        
        const formData = {
            household_id: $('#household').val(),
            child_first_name: $('#firstName').val(),
            child_surname: $('#lastName').val(),
            child_gender: $('#gender').val(),
            child_year_birth: $('#yearOfBirth').val(),
            child_birth_certificate: $('#birthCertificate').val(),
            child_educated: $('#educationStatus').val(),
            child_school_name: $('#schoolName').val()
        };
        
        createChildRecord(formData);
    });

    function createChildRecord(formData) {
        $.ajax({
            url: "{% url 'create_farmer_child_api' %}",
            type: "POST",
            data: JSON.stringify(formData),
            contentType: "application/json",
            headers: {
                'X-CSRFToken': getCookie('csrftoken')
            },
            beforeSend: function() {
                $('#saveBtn').prop('disabled', true).html('<i class="fas fa-spinner fa-spin"></i> Saving...');
            },
            success: function(response) {
                if (response.success) {
                    showSuccessAlert('Child record created successfully');
                    $('#newChildModal').modal('hide');
                    $('#childForm').removeClass('was-validated');
                    childrenTable.ajax.reload();
                } else {
                    showErrorAlert(response.message || 'Failed to create child record');
                }
            },
            error: function(xhr) {
                handleAjaxError(xhr, 'create child record');
            },
            complete: function() {
                $('#saveBtn').prop('disabled', false).html('Save Child');
            }
        });
    }

    // ----- DELETE CHILD RECORD -----
    $(document).on('click', '.delete-child-btn', function() {
        const childId = $(this).data('id');
        
        Swal.fire({
            title: 'Delete Child Record?',
            text: "Are you sure you want to delete this child record? This action cannot be undone.",
            icon: 'warning',
            showCancelButton: true,
            confirmButtonColor: '#d33',
            cancelButtonColor: '#3085d6',
            confirmButtonText: 'Yes, delete it!',
            cancelButtonText: 'Cancel'
        }).then((result) => {
            if (result.isConfirmed) {
                deleteChildRecord(childId);
            }
        });
    });

    function deleteChildRecord(childId) {
        $.ajax({
            url: "{% url 'delete_farmer_child_api' 0 %}".replace('0', childId),
            type: "DELETE",
            headers: {
                'X-CSRFToken': getCookie('csrftoken')
            },
            beforeSend: function() {
                showLoadingAlert('Deleting child record...');
            },
            success: function(response) {
                Swal.close();
                if (response.success) {
                    showSuccessAlert('Child record deleted successfully');
                    childrenTable.ajax.reload();
                } else {
                    showErrorAlert(response.message || 'Failed to delete child record');
                }
            },
            error: function(xhr) {
                handleAjaxError(xhr, 'delete child record');
            }
        });
    }

    // Generate Children Report
    function generateChildrenReport() {
        showSuccessAlert('Report generation will be implemented in the next phase');
    }

    // Initialize page
    loadFilterOptions();
    childrenTable.ajax.reload();
});
// Helper functions for AJAX requests
function getCookie(name) {
    let cookieValue = null;
    if (document.cookie && document.cookie !== '') {
        const cookies = document.cookie.split(';');
        for (let i = 0; i < cookies.length; i++) {
            const cookie = cookies[i].trim();
            if (cookie.substring(0, name.length + 1) === (name + '=')) {
                cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                break;
            }
        }
    }
    return cookieValue;
}

function showSuccessAlert(message) {
    Swal.fire({
        icon: 'success',
        title: 'Success',
        text: message,
        timer: 3000,
        showConfirmButton: false
    });
}

function showErrorAlert(message) {
    Swal.fire({
        icon: 'error',
        title: 'Error',
        text: message,
        timer: 5000
    });
}

function showLoadingAlert(message) {
    Swal.fire({
        title: 'Please wait...',
        text: message,
        allowOutsideClick: false,
        didOpen: () => {
            Swal.showLoading();
        }
    });
}

function handleAjaxError(xhr, action) {
    let errorMessage = `Failed to ${action}. `;
    
    if (xhr.responseJSON && xhr.responseJSON.message) {
        errorMessage += xhr.responseJSON.message;
    } else if (xhr.status === 0) {
        errorMessage += 'Network error. Please check your connection.';
    } else if (xhr.status === 404) {
        errorMessage += 'Resource not found.';
    } else if (xhr.status === 500) {
        errorMessage += 'Server error. Please try again later.';
    } else {
        errorMessage += 'Unknown error occurred.';
    }
    
    showErrorAlert(errorMessage);
}
</script>

<style>
.btn-gradient-primary {
    background: linear-gradient(45deg, #4e73df, #224abe);
    color: white;
    border: none;
}
.card {
    transition: transform 0.2s ease-in-out;
}
.card:hover {
    transform: translateY(-1px);
}
.badge {
    font-size: 0.75em;
    padding: 0.35em 0.65em;
}
.table th {
    font-weight: 600;
    text-transform: uppercase;
    font-size: 0.8rem;
}
</style>
{% endblock %}